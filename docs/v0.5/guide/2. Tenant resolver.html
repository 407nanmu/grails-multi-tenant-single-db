<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>2. Tenant resolver</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="2. Tenant resolver">2. Tenant resolver</a></h1>The <strong class="bold">tenant resolver</strong> is point on your application that will detect witch tenant will deal the current request that is made on your application.
Most multi-tenant applications would define tenant based on the URL used to reach your application, but you can check for some user's session attribute, or any other think that you want.<p class="paragraph"/>When implementing your own tenant resolver, you'll have to implement the <code>grails.plugin.multitenant.core.resolve.TenantResolver</code> interface and override the <code>public Integer resolve(HttpServletRequest request)</code> method.<p class="paragraph"/>For example, imagine you have the '*.greatapp.com' hosting your application.
<ul class="star">
<li>Requests coming from 'john.greatapp.com' would resolve the tenant for user john, so tenant 1</li>
<li>Requests coming from 'mary.greatapp.com' would resolve the tenant for user mary, so tenant 2</li>
<li>Requests coming from 'paul.greatapp.com' would resolve the tenant for user paul, so tenant 3</li>
</ul><p class="paragraph"/>The code below shows how a simple Tenant Resolver implementation should be.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.multitenant.core.resolve.TenantResolver<p class="paragraph"/>class TenantDomainResolver <span class="java&#45;keyword">implements</span> TenantResolver &#123;<p class="paragraph"/>    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">Integer</span> resolve(HttpServletRequest request) &#123;<p class="paragraph"/>        <span class="java&#45;object">String</span> host = request.getServerName()
        <span class="java&#45;keyword">switch</span> (host) &#123;
            <span class="java&#45;keyword">case</span> <span class="java&#45;quote">"john.greatapp.com"</span>:
                <span class="java&#45;keyword">return</span> 1<p class="paragraph"/>            <span class="java&#45;keyword">case</span> <span class="java&#45;quote">"mary.greatapp.com"</span>:
                <span class="java&#45;keyword">return</span> 2<p class="paragraph"/>            <span class="java&#45;keyword">case</span> <span class="java&#45;quote">"paul.greatapp.com"</span>:
                <span class="java&#45;keyword">return</span> 3<p class="paragraph"/>            <span class="java&#45;keyword">default</span>:
                <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>
        &#125;
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>Of course, your application will probably look this information up from a database (and cache it).<p class="paragraph"/><h3>When Tenant has not been found</h3><p class="paragraph"/>In the example above, if the tenant has not been found, it would return null. <strong class="bold">Be careful with this approach</strong>, returning null, query restrictions will not be applied, so, data of all tenants will be returned when queried.<p class="paragraph"/>
    </body>
</html>
